---
# Download
monit_version: "5.17.1"
monit_download_url: 'https://bitbucket.org/tildeslash/monit/downloads/monit-{{ monit_version }}-linux-x64.tar.gz'

# Mailserver
monit_mail_enabled: false
monit_mailserver_host: localhost
monit_mailserver_port: 25

# Webinterface
monit_webinterface_enabled: true
monit_webinterface_bind: 0.0.0.0
monit_webinterface_port: 2812
monit_webinterface_acl_rules:
  - "admin:monit"

# Alerts
monit_alert_address: ''

# MMonit collector
# for example https://monituser:p455w0rd@your-server.com:2811/collector
mmonit_collector: ''

# If endabled, all alerts are send to slack
monit_use_slack: false
monit_slack_url: 'https://YYYYY.slack.com/services/hooks/incoming-webhook?token=XXXXX'

# Services for all plays
monit_default_services: []

# Services defined by group vars
monit_group_services: []

# Services defined by host vars
monit_host_services: []

# Custom services
monit_service_fail2ban:
  - name: fail2ban
    type: process
    target:  /var/run/fail2ban/fail2ban.pid
    start: /usr/sbin/service fail2ban start
    stop: /usr/sbin/service fail2ban stop
    rules:
      - if cpu > 98% for 5 cycles then restart
      - if failed unixsocket /var/run/fail2ban/fail2ban.sock then restart
      - if 5 restarts within 5 cycles then alert
      - depends on fail2ban_bin,fail2ban_rc

  - name: fail2ban_bin
    type: file
    target: /usr/local/bin/fail2ban-server
    rules:
      - if failed checksum then unmonitor
      - if failed permission 755 then unmonitor
      - if failed uid root then unmonitor
#      - if failed gid root then unmonitor

  - name: fail2ban_rc
    type: file
    target: /lib/systemd/system/fail2ban.service
    rules:
      - if failed checksum then unmonitor
      - if failed permission 751 then unmonitor
      - if failed uid root then unmonitor
      - if failed gid root then unmonitor

monit_service_exim4:
  - name: exim4
    type: process
    target: /var/run/exim4/exim.pid
    start: /usr/sbin/service exim4 start
    stop: /usr/sbin/service exim4 stop
    rules:
      - if cpu > 98% for 5 cycles then restart
      - if failed port 25 protocol smtp for 3 cycles then restart
      - if 5 restarts within 5 cycles then alert
      - depends on exim_bin, exim_rc

  - name: exim_bin
    type: file
    target: /usr/sbin/exim
    rules:
      - if failed checksum then unmonitor
      - if failed permission 4755 then unmonitor
      - if failed uid root then unmonitor
      - if failed gid root then unmonitor

  - name: exim_rc
    type: file
    target: /etc/init.d/exim4
    rules:
      - if failed checksum then unmonitor
      - if failed permission 755 then unmonitor
      - if failed uid root then unmonitor
      - if failed gid root then unmonitor
